<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.55.0/L.Control.Locate.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0/MarkerCluster.Default.css" />
		<link rel="stylesheet" href="https://cdn.rawgit.com/naomap/leaflet-fusesearch/master/src/leaflet.fusesearch.css" />
		
		 <style type="text/css">
			body {  padding: 0; margin: 0;  }
			html, body, #map {  height: 100%;  }
		</style>
		
		<title>Assets</title>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.55.0/L.Control.Locate.min.js" ></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0/leaflet.markercluster.js"></script>
		<script src="https://cdn.rawgit.com/naomap/leaflet-fusesearch/master/src/leaflet.fusesearch.js"></script>
		
	</head>
	<body>
		<div id="map"></div>
		
		<script>
			var VMmap = L.tileLayer.wms("http://api.maps.vic.gov.au/geowebcacheWM/service/wms?", {
				layers: 'WEB_MERCATOR',
				format: 'image/png',
				transparent: true,
				version: '1.1.1',
				attribution: "© Vicmap API"});
			
			var VMhybrid = L.tileLayer.wms("http://api.maps.vic.gov.au/geowebcacheWM/service/wms?", {
				layers: 'HYBRID_MERCATOR',
				format: 'image/png',
				transparent: true,
				version: '1.1.1',
				attribution: "© Vicmap API"});
			
			var VMsat = L.tileLayer.wms("http://api.maps.vic.gov.au/geowebcacheWM/service/wms?", {
				layers: 'SATELLITE_WM',
				format: 'image/png',
				transparent: true,
				version: '1.1.1',
				attribution: "© Vicmap API"});
			
			var VM = L.layerGroup([VMsat, VMhybrid]);
						
			var baseMaps = {
				"Map"	: VMmap,
				"Aerial": VM,
			};
			
			var map = L.map('map', {
				//center	: [-36.72855, 146.96087],
				//zoom	: 17,
				layers	: [VMmap]
			});
			
			L.control.layers(baseMaps).addTo(map);
			L.control.locate().addTo(map);
			
			$.getJSON("https://web.fulcrumapp.com/shares/f4da6fb7e1f60b20.geojson", function(data) {
    				addGeoJsonLayerWithClustering(data);
  			});
			
			function addGeoJsonLayerWithClustering(data) {
      				var markers = L.markerClusterGroup({
					spiderfyOnMaxZoom: true,
					showCoverageOnHover: false,
					zoomToBoundsOnClick: true,
					removeOutsideVisibleBounds: true
				});
      				var geoJsonLayer = L.geoJson(data, {
          				onEachFeature: function (feature, layer) {
              					layer.bindPopup(feature.properties.action_required);
						feature.layer = layer;
          				}
      				});
      				markers.addLayer(geoJsonLayer);
      				map.addLayer(markers);
        			map.fitBounds(markers.getBounds());
			}
  
			var searchCtrl = L.control.fuseSearch();
			searchCtrl.addTo(map);
			
			searchCtrl.indexFeatures(geoJsonLayer, ['action_required']);
			
			
			
			/*var markers = L.markerClusterGroup();
			
			var geojsonMarkerOptions = {
    				radius: 8,
    				fillColor: "#ff7800",
   				color: "#000",
    				weight: 1,
    				opacity: 1,
    				fillOpacity: 0.8
			};
			
			markers.addLayer($.getJSON("https://web.fulcrumapp.com/shares/f4da6fb7e1f60b20.geojson", function(data) {
   		 		L.geoJson(data, {
        				style: geojsonMarkerOptions
    				});
			}));
						
			//markers.addLayer(geoJsonLayer);
			
			map.addLayer(markers);
			*/
			//Vicmap API hybrid aerial layer
			//var VMsat = L.tileLayer('http://api.maps.vic.gov.au/geowebcacheWM/service/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=SATELLITE_WM&STYLE=_null&FORMAT=image/png&TILEMATRIXSET=BT_ESRI_EPSG:3857&TILEMATRIX=BT_ESRI_EPSG:3857:{z}&TILEROW={y}&TILECOL={x}', {
			//	tileSize : 512,
			//	zoomOffset : -6,
			//	attribution : "Â© Vicmap API"});
			
			//Vicmap API aerial layer
			//var VMsat2 = L.tileLayer('http://api.maps.vic.gov.au/geowebcacheWM/service/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=SATELLITE_WM&STYLE=_null&FORMAT=image/png&TILEMATRIXSET=BT_ESRI_EPSG:3857&TILEMATRIX=BT_ESRI_EPSG:3857:{z}&TILEROW={y}&TILECOL={x}', {
			//	tileSize : 512,
			//	zoomOffset : -6,
			//	attribution : "Â© Vicmap API"});
		</script>	
	</body>
 </html>
